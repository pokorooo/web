<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Çø„Ç§„Éî„É≥„Ç∞„Ç≤„Éº„É† | pokoro</title>
    <link rel="icon" href="/icon.png" type="image/png">
    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Q3F3DJ865S"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-Q3F3DJ865S');
    </script>
    <style>
        .navbar {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 70px;
        }
        .nav-logo {
            display: flex;
            align-items: center;
        }
        .nav-logo h2 {
            color: #777;
            font-weight: 700;
            font-size: 1.4rem;
            background: linear-gradient(45deg, #999, #777);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(0, 0, 0, 0.1);
        }
        .nav-menu {
            display: flex;
            list-style: none;
            gap: 30px;
        }
        .nav-link {
            text-decoration: none;
            color: #777;
            font-weight: 500;
            transition: all 0.3s ease;
            position: relative;
            padding: 8px 16px;
            border-radius: 8px;
        }
        .nav-link:hover {
            color: #999;
            background: rgba(0, 0, 0, 0.03);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
            transform: translateY(-2px);
        }
        .nav-link::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: 2px;
            left: 50%;
            background: linear-gradient(45deg, #999, #bbb);
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }
        .nav-link:hover::after {
            width: 80%;
        }
        .hamburger {
            display: none;
            flex-direction: column;
            cursor: pointer;
        }
        .bar {
            width: 25px;
            height: 3px;
            background: linear-gradient(45deg, #999, #bbb);
            margin: 3px 0;
            transition: 0.3s;
            border-radius: 2px;
        }
        @media (max-width: 768px) {
            .hamburger {
                display: flex;
            }
            .nav-menu {
                position: fixed;
                left: -100%;
                top: 70px;
                flex-direction: column;
                background-color: white;
                width: 100%;
                text-align: center;
                transition: 0.3s;
                box-shadow: 0 10px 27px rgba(0, 0, 0, 0.05);
                padding: 20px 0;
            }
            .nav-menu.active {
                left: 0;
            }
            .nav-menu li {
                margin: 10px 0;
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hiragino Kaku Gothic ProN', '„Éí„É©„ÇÆ„ÉéËßí„Ç¥ ProN W3', 'Meiryo', '„É°„Ç§„É™„Ç™', sans-serif;
            line-height: 1.6;
            color: #555;
            background: linear-gradient(135deg, #fefefe 0%, #f8f9fa 50%, #f1f3f4 100%);
            min-height: 100vh;
            padding-top: 70px;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(240, 240, 240, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 80%, rgba(220, 220, 220, 0.3) 0%, transparent 50%);
            z-index: -2;
            animation: gradientShift 15s ease infinite;
        }

        @keyframes gradientShift {
            0%, 100% { 
                background: 
                    radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.3) 0%, transparent 50%),
                    radial-gradient(circle at 80% 20%, rgba(240, 240, 240, 0.3) 0%, transparent 50%),
                    radial-gradient(circle at 40% 80%, rgba(220, 220, 220, 0.3) 0%, transparent 50%);
            }
            25% { 
                background: 
                    radial-gradient(circle at 70% 30%, rgba(255, 255, 255, 0.3) 0%, transparent 50%),
                    radial-gradient(circle at 30% 70%, rgba(240, 240, 240, 0.3) 0%, transparent 50%),
                    radial-gradient(circle at 90% 40%, rgba(220, 220, 220, 0.3) 0%, transparent 50%);
            }
            50% { 
                background: 
                    radial-gradient(circle at 80% 80%, rgba(255, 255, 255, 0.3) 0%, transparent 50%),
                    radial-gradient(circle at 20% 30%, rgba(240, 240, 240, 0.3) 0%, transparent 50%),
                    radial-gradient(circle at 60% 20%, rgba(220, 220, 220, 0.3) 0%, transparent 50%);
            }
            75% { 
                background: 
                    radial-gradient(circle at 30% 20%, rgba(255, 255, 255, 0.3) 0%, transparent 50%),
                    radial-gradient(circle at 90% 80%, rgba(240, 240, 240, 0.3) 0%, transparent 50%),
                    radial-gradient(circle at 10% 60%, rgba(220, 220, 220, 0.3) 0%, transparent 50%);
            }
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .header h1 {
            font-size: 2.5rem;
            font-weight: 700;
            color: #777;
            margin-bottom: 10px;
            background: linear-gradient(135deg, #777 0%, #999 50%, #bbb 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: rgba(0, 0, 0, 0.6);
            font-size: 1.1rem;
        }

        .game-container {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(20px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.6);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 12px;
            text-align: center;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: #777;
            margin-bottom: 5px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: rgba(0, 0, 0, 0.6);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .text-display {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 30px;
            margin: 30px 0;
            font-size: 1.3rem;
            line-height: 1.8;
            border: 2px solid #e9ecef;
            min-height: 120px;
            font-family: 'Courier New', monospace;
            user-select: none;
            outline: none;
            cursor: default;
        }
        
        .text-display:focus {
            border-color: #999;
            box-shadow: 0 0 0 3px rgba(153, 153, 153, 0.1);
        }

        .char {
            position: relative;
        }

        .char.correct {
            background-color: #d4edda;
            color: #155724;
        }

        .char.incorrect {
            background-color: #f8d7da;
            color: #721c24;
        }

        .char.current {
            background-color: #fff3cd;
            color: #856404;
            animation: blink 1s infinite;
        }

        @keyframes blink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0.3; }
        }

        .controls {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 30px 0;
            flex-wrap: wrap;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
        }

        .btn-primary {
            background: linear-gradient(135deg, #999 0%, #bbb 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
            background: linear-gradient(135deg, #bbb 0%, #999 100%);
        }

        .btn-secondary {
            background: #f8f9fa;
            color: #777;
            border: 1px solid #dee2e6;
        }

        .btn-secondary:hover {
            background: #e9ecef;
            transform: translateY(-2px);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .difficulty-selector {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin: 20px 0;
        }

        .difficulty-btn {
            padding: 8px 16px;
            border: 2px solid #dee2e6;
            background: #f8f9fa;
            color: #777;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .difficulty-btn.active {
            background: #999;
            color: white;
            border-color: #999;
        }

        .result-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .result-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            text-align: center;
            max-width: 400px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.2);
        }

        .result-title {
            font-size: 2rem;
            color: #777;
            margin-bottom: 20px;
        }

        .result-stats {
            margin: 20px 0;
        }

        .result-stat {
            margin: 10px 0;
            font-size: 1.1rem;
        }

        .hidden {
            display: none !important;
        }

        .back-link {
            display: inline-flex;
            align-items: center;
            color: #777;
            text-decoration: none;
            margin-bottom: 20px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .back-link:hover {
            color: #999;
            transform: translateX(-3px);
        }

        .back-link svg {
            margin-right: 8px;
            width: 16px;
            height: 16px;
        }

        /* „É¨„Çπ„Éù„É≥„Ç∑„Éñ */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }
            
            .game-container {
                padding: 20px;
            }
            
            .text-display {
                font-size: 1.1rem;
                padding: 20px;
            }
            
            .stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .controls {
                flex-direction: column;
                align-items: center;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <div class="nav-logo">
                <img src="/icon.png" alt="pokoro" style="width: 32px; height: 32px; margin-right: 10px;">
                <h2><a href="/" style="text-decoration: none; color: inherit;">pokoro</a></h2>
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="/tool/index.html" class="nav-link">„ÉÑ„Éº„É´</a>
                </li>
                <li class="nav-item">
                    <a href="/game/homepage.html" class="nav-link">„Ç≤„Éº„É†</a>
                </li>
                <li class="nav-item">
                    <a href="https://pokoroblog.com/" class="nav-link">„Éñ„É≠„Ç∞</a>
                </li>
            </ul>
            <div class="hamburger">
                <span class="bar"></span>
                <span class="bar"></span>
                <span class="bar"></span>
            </div>
        </div>
    </nav>

    <div class="container">
        <a href="/game/homepage.html" class="back-link">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
            </svg>
            „Ç≤„Éº„É†‰∏ÄË¶ß„Å´Êàª„Çã
        </a>

        <div class="header">
            <h1>‚å®Ô∏è „Çø„Ç§„Éî„É≥„Ç∞„Ç≤„Éº„É†</h1>
            <p>Ê≠£Á¢∫„ÅßÈÄü„ÅÑ„Çø„Ç§„Éî„É≥„Ç∞„ÇíÁõÆÊåá„Åù„ÅÜÔºÅ</p>
        </div>

        <div class="game-container">
            <div class="stats">
                <div class="stat-card">
                    <div class="stat-value" id="wpm">0</div>
                    <div class="stat-label">WPM</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="accuracy">100%</div>
                    <div class="stat-label">Ê≠£Á¢∫Áéá</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="timer">60</div>
                    <div class="stat-label">ÊÆã„ÇäÊôÇÈñì</div>
                </div>
                <div class="stat-card">
                    <div class="stat-value" id="errors">0</div>
                    <div class="stat-label">„Ç®„É©„ÉºÊï∞</div>
                </div>
            </div>

            <div class="difficulty-selector">
                <button class="difficulty-btn active" data-difficulty="easy">Á∞°Âçò (30Áßí)</button>
                <button class="difficulty-btn" data-difficulty="medium">‰∏≠Á¥ö (60Áßí)</button>
                <button class="difficulty-btn" data-difficulty="hard">Èõ£„Åó„ÅÑ (90Áßí)</button>
            </div>

            <div class="text-display" id="textDisplay" tabindex="0">
                „Ç≤„Éº„É†„ÇíÈñãÂßã„Åó„Å¶„Åè„Å†„Åï„ÅÑ
            </div>

            <div class="controls">
                <button class="btn btn-primary" id="startBtn">„Ç≤„Éº„É†ÈñãÂßã</button>
                <button class="btn btn-secondary" id="resetBtn">„É™„Çª„ÉÉ„Éà</button>
            </div>
        </div>
    </div>

    <!-- ÁµêÊûú„É¢„Éº„ÉÄ„É´ -->
    <div class="result-modal" id="resultModal">
        <div class="result-content">
            <h2 class="result-title">„Ç≤„Éº„É†ÁµÇ‰∫ÜÔºÅ</h2>
            <div class="result-stats">
                <div class="result-stat">WPM: <span id="finalWPM">0</span></div>
                <div class="result-stat">Ê≠£Á¢∫Áéá: <span id="finalAccuracy">0%</span></div>
                <div class="result-stat">Á∑è„Ç®„É©„ÉºÊï∞: <span id="finalErrors">0</span></div>
                <div class="result-stat">ÂÆå‰∫ÜÁä∂Ê≥Å: <span id="finalChars">0</span></div>
            </div>
            <button class="btn btn-primary" onclick="closeModal()">„ÇÇ„ÅÜ‰∏ÄÂ∫¶„Éó„É¨„Ç§</button>
        </div>
    </div>

    <script>
        class TypingGame {
            constructor() {
                this.currentText = '';
                this.currentIndex = 0;
                this.startTime = null;
                this.timerInterval = null;
                this.gameActive = false;
                this.errors = 0;
                this.totalTyped = 0;
                this.difficulty = 'medium';
                this.timeLimit = 60;
                
                // „É≠„Éº„ÉûÂ≠óÂÖ•ÂäõÁî®„ÅÆÁä∂ÊÖã
                this.currentRomaji = '';
                this.romajiTargets = [];
                this.currentTargetIndex = 0;
                
                // ÂïèÈ°å„Éá„Éº„Çø
                this.textSamples = {};
                
                // 5ÂïèÈÄ£Á∂ö„É¢„Éº„Éâ
                this.problemsPerGame = 5;
                this.currentProblemIndex = 0;
                this.currentProblems = [];
                this.currentJapaneseList = [];
                
                // „É≠„Éº„ÉûÂ≠óÂ§âÊèõ„ÉÜ„Éº„Éñ„É´
                this.romajiTable = {
                    '„ÅÇ': ['a'], '„ÅÑ': ['i'], '„ÅÜ': ['u'], '„Åà': ['e'], '„Åä': ['o'],
                    '„Åã': ['ka'], '„Åç': ['ki'], '„Åè': ['ku'], '„Åë': ['ke'], '„Åì': ['ko'],
                    '„Åå': ['ga'], '„Åé': ['gi'], '„Åê': ['gu'], '„Åí': ['ge'], '„Åî': ['go'],
                    '„Åï': ['sa'], '„Åó': ['si', 'shi'], '„Åô': ['su'], '„Åõ': ['se'], '„Åù': ['so'],
                    '„Åñ': ['za'], '„Åò': ['zi', 'ji'], '„Åö': ['zu'], '„Åú': ['ze'], '„Åû': ['zo'],
                    '„Åü': ['ta'], '„Å°': ['ti', 'chi'], '„Å§': ['tu', 'tsu'], '„Å¶': ['te'], '„Å®': ['to'],
                    '„Å†': ['da'], '„Å¢': ['di'], '„Å•': ['du'], '„Åß': ['de'], '„Å©': ['do'],
                    '„Å™': ['na'], '„Å´': ['ni'], '„Å¨': ['nu'], '„Å≠': ['ne'], '„ÅÆ': ['no'],
                    '„ÅØ': ['ha'], '„Å≤': ['hi'], '„Åµ': ['hu', 'fu'], '„Å∏': ['he'], '„Åª': ['ho'],
                    '„Å∞': ['ba'], '„Å≥': ['bi'], '„Å∂': ['bu'], '„Åπ': ['be'], '„Åº': ['bo'],
                    '„Å±': ['pa'], '„Å¥': ['pi'], '„Å∑': ['pu'], '„Å∫': ['pe'], '„ÅΩ': ['po'],
                    '„Åæ': ['ma'], '„Åø': ['mi'], '„ÇÄ': ['mu'], '„ÇÅ': ['me'], '„ÇÇ': ['mo'],
                    '„ÇÑ': ['ya'], '„ÇÜ': ['yu'], '„Çà': ['yo'],
                    '„Çâ': ['ra'], '„Çä': ['ri'], '„Çã': ['ru'], '„Çå': ['re'], '„Çç': ['ro'],
                    '„Çè': ['wa'], '„Çê': ['wi'], '„Çë': ['we'], '„Çí': ['wo'], '„Çì': ['n', 'nn'],
                    
                    // „Ç´„Çø„Ç´„Éä
                    '„Ç¢': ['a'], '„Ç§': ['i'], '„Ç¶': ['u'], '„Ç®': ['e'], '„Ç™': ['o'],
                    '„Ç´': ['ka'], '„Ç≠': ['ki'], '„ÇØ': ['ku'], '„Ç±': ['ke'], '„Ç≥': ['ko'],
                    '„Ç¨': ['ga'], '„ÇÆ': ['gi'], '„Ç∞': ['gu'], '„Ç≤': ['ge'], '„Ç¥': ['go'],
                    '„Çµ': ['sa'], '„Ç∑': ['si', 'shi'], '„Çπ': ['su'], '„Çª': ['se'], '„ÇΩ': ['so'],
                    '„Ç∂': ['za'], '„Ç∏': ['zi', 'ji'], '„Ç∫': ['zu'], '„Çº': ['ze'], '„Çæ': ['zo'],
                    '„Çø': ['ta'], '„ÉÅ': ['ti', 'chi'], '„ÉÑ': ['tu', 'tsu'], '„ÉÜ': ['te'], '„Éà': ['to'],
                    '„ÉÄ': ['da'], '„ÉÇ': ['di'], '„ÉÖ': ['du'], '„Éá': ['de'], '„Éâ': ['do'],
                    '„Éä': ['na'], '„Éã': ['ni'], '„Éå': ['nu'], '„Éç': ['ne'], '„Éé': ['no'],
                    '„Éè': ['ha'], '„Éí': ['hi'], '„Éï': ['hu', 'fu'], '„Éò': ['he'], '„Éõ': ['ho'],
                    '„Éê': ['ba'], '„Éì': ['bi'], '„Éñ': ['bu'], '„Éô': ['be'], '„Éú': ['bo'],
                    '„Éë': ['pa'], '„Éî': ['pi'], '„Éó': ['pu'], '„Éö': ['pe'], '„Éù': ['po'],
                    '„Éû': ['ma'], '„Éü': ['mi'], '„É†': ['mu'], '„É°': ['me'], '„É¢': ['mo'],
                    '„É§': ['ya'], '„É¶': ['yu'], '„É®': ['yo'],
                    '„É©': ['ra'], '„É™': ['ri'], '„É´': ['ru'], '„É¨': ['re'], '„É≠': ['ro'],
                    '„ÉØ': ['wa'], '„É∞': ['wi'], '„É±': ['we'], '„É≤': ['wo'], '„É≥': ['n', 'nn'],
                    
                    // Ë®òÂè∑„ÉªËã±Êï∞Â≠ó„ÅØ„Åù„ÅÆ„Åæ„Åæ
                    ' ': [' '], '„ÄÇ': ['.'], '„ÄÅ': [','], 'ÔºÅ': ['!'], 'Ôºü': ['?'],
                    'Ôºà': ['('], 'Ôºâ': [')'], '„Äå': ['['], '„Äç': [']'],
                    '„Éº': ['-'], '„Äú': ['~'], 'Ôºö': [':'], 'Ôºõ': [';']
                };
                
                this.textSamples = {
                    easy: [
                        {
                            japanese: "„Åì„Çì„Å´„Å°„ÅØ„ÄÇ‰ªäÊó•„ÅØ„ÅÑ„ÅÑÂ§©Ê∞ó„Åß„Åô„Å≠„ÄÇ",
                            romaji: "konnichihakyouhaiitenkidesune"
                        },
                        {
                            japanese: "„Éó„É≠„Ç∞„É©„Éü„É≥„Ç∞„ÅØÊ•Ω„Åó„ÅÑ„Åß„Åô„ÄÇ",
                            romaji: "puroguraminguhatanosiiidesu"
                        },
                        {
                            japanese: "„Ç≥„Éº„Éí„Éº„ÇíÈ£≤„Åø„Å™„Åå„Çâ‰ΩúÊ•≠„Åó„Åæ„Åô„ÄÇ",
                            romaji: "ko-hi-wonominagarasagyousimasu"
                        },
                        {
                            japanese: "Êñ∞„Åó„ÅÑÊäÄË°ì„ÇíÂ≠¶„Å∂„ÅÆ„ÅåÂ•Ω„Åç„Åß„Åô„ÄÇ",
                            romaji: "atarasigijutuomanabunogasukidesu"
                        },
                        {
                            japanese: "ÊØéÊó•Â∞ë„Åó„Åö„Å§ÊàêÈï∑„Åó„Å¶„ÅÑ„Åç„Åæ„Åô„ÄÇ",
                            romaji: "mainichisukosidutuseicousiteikimasu"
                        },
                        {
                            japanese: "„ÅäÁñ≤„ÇåÊßò„Åß„Åó„Åü„ÄÇ",
                            romaji: "otukaresamadesita"
                        },
                        {
                            japanese: "ÊòéÊó•„ÅØ‰ºë„Åø„Åß„Åô„ÄÇ",
                            romaji: "asitahayasumiidesu"
                        },
                        {
                            japanese: "„Éë„ÇΩ„Ç≥„É≥„ÅßË≥áÊñô„Çí‰ΩúÊàê„Åó„Åæ„Åô„ÄÇ",
                            romaji: "pasokondesiryo-wosakuseisimasu"
                        },
                        {
                            japanese: "ÂèãÈÅî„Å®Êò†Áîª„ÇíË¶ã„Å´Ë°å„Åç„Åæ„Åô„ÄÇ",
                            romaji: "tomodachitoeigawominiikimasu"
                        },
                        {
                            japanese: "ÂãâÂº∑„Åô„Çã„ÅÆ„ÅØÂ§ßÂàá„Åß„Åô„ÄÇ",
                            romaji: "benkyousurunohataisetudesu"
                        },
                        {
                            japanese: "‰ªäÊó•„ÅÆÂ§©Ê∞ó„ÅØÊô¥„Çå„Åß„Åô„ÄÇ",
                            romaji: "kyounotenkihaharedesu"
                        },
                        {
                            japanese: "ÈõªËªä„Åß‰ºöÁ§æ„Å´Ë°å„Åç„Åæ„Åô„ÄÇ",
                            romaji: "denshadekaishaniiikimasu"
                        },
                        {
                            japanese: "ÊòºÈ£ü„ÅØ„É¨„Çπ„Éà„É©„É≥„ÅßÈ£ü„Åπ„Åæ„Åô„ÄÇ",
                            romaji: "chuushokuharesutorandetabemasu"
                        },
                        {
                            japanese: "Êú¨„ÇíË™≠„ÇÄ„ÅÆ„ÅåË∂£Âë≥„Åß„Åô„ÄÇ",
                            romaji: "honwoyomunogashumidesu"
                        },
                        {
                            japanese: "Êó•Êú¨Ë™û„ÇíÂ≠¶Áøí„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ",
                            romaji: "nihongowogakushuushiteimasu"
                        },
                        {
                            japanese: "Èü≥Ê•Ω„ÇíËÅû„Åè„ÅÆ„ÅåÂ•Ω„Åç„Åß„Åô„ÄÇ",
                            romaji: "ongakuwokikunogasukidesu"
                        },
                        {
                            japanese: "ÂÆ∂Êóè„Å®‰∏ÄÁ∑í„Å´‰Ωè„Çì„Åß„ÅÑ„Åæ„Åô„ÄÇ",
                            romaji: "kazokutoisshoninundeimasu"
                        },
                        {
                            japanese: "ÈÄ±Êú´„ÅØÂÖ¨Âúí„ÇíÊï£Ê≠©„Åó„Åæ„Åô„ÄÇ",
                            romaji: "shuumatsuhakouen-wosanposhimasu"
                        },
                        {
                            japanese: "Êñ∞„Åó„ÅÑ„Éó„É≠„Ç∏„Çß„ÇØ„Éà„ÅåÂßã„Åæ„Çä„Åæ„Åó„Åü„ÄÇ",
                            romaji: "atarashiipurojekutogahashimarimashita"
                        },
                        {
                            japanese: "ÊôÇÈñì„Åå„ÅÇ„Çã„Å®„Åç„ÅØË™≠Êõ∏„Çí„Åó„Åæ„Åô„ÄÇ",
                            romaji: "jikangaarutokihadokushowoshimasu"
                        },
                        {
                            japanese: "„Çπ„Éù„Éº„ÉÑ„Çí„Åô„Çã„ÅÆ„ÅØÂÅ•Â∫∑„Å´ËâØ„ÅÑ„Åß„Åô„ÄÇ",
                            romaji: "supo-tsuwosururunohakenkouniyoidesu"
                        },
                        {
                            japanese: "‰ºöË≠∞„ÅÆÊ∫ñÂÇô„Çí„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ",
                            romaji: "kaigino junbiwoshiteimasu"
                        },
                        {
                            japanese: "‰ªäÂ∫¶‰∏ÄÁ∑í„Å´Êò†Áîª„ÇíË¶ã„Åæ„Åõ„Çì„Åã„ÄÇ",
                            romaji: "kondoisshonnieigawomimasenka"
                        },
                        {
                            japanese: "ÁæéÂë≥„Åó„ÅÑÊñôÁêÜ„Çí‰Ωú„Çä„Åæ„Åó„Åü„ÄÇ",
                            romaji: "oishiiryouriwotsukurimashita"
                        },
                        {
                            japanese: "Ë≤∑„ÅÑÁâ©„Å´Ë°å„Åè‰∫àÂÆö„Åß„Åô„ÄÇ",
                            romaji: "kaimononiikuyoteidesu"
                        },
                        {
                            japanese: "Ëã±Ë™û„ÇÇÂãâÂº∑„Åó„Åü„ÅÑ„Åß„Åô„ÄÇ",
                            romaji: "eigomobenkyoushitaidesu"
                        },
                        {
                            japanese: "Êó©Ëµ∑„Åç„ÅØÂÅ•Â∫∑„Å´ËâØ„ÅÑ„Å®ÊÄù„ÅÑ„Åæ„Åô„ÄÇ",
                            romaji: "hayaokihakenkouniyoitoomoimasu"
                        },
                        {
                            japanese: "„Ç≥„É≥„Éî„É•„Éº„Çø„Éº„Çí‰Ωø„ÅÜ„ÅÆ„ÅØÁ∞°Âçò„Åß„Åô„ÄÇ",
                            romaji: "konpyu-ta-wotsukarunohakantandesu"
                        },
                        {
                            japanese: "ÊòéÊó•„ÅÆ‰ºöË≠∞„ÅÆË≥áÊñô„Çí‰ΩúÊàê‰∏≠„Åß„Åô„ÄÇ",
                            romaji: "ashitanokaiginoshiryouwosakuseichuudesu"
                        },
                        {
                            japanese: "„Ç§„É≥„Çø„Éº„Éç„ÉÉ„Éà„ÅßÊÉÖÂ†±„ÇíÊ§úÁ¥¢„Åó„Åæ„Åó„Åü„ÄÇ",
                            romaji: "inta-nettodejouhouokensakushimashita"
                        }
                    ],
                    medium: [
                        {
                            japanese: "JavaScript „ÅØÂãïÁöÑ„Å™„Éó„É≠„Ç∞„É©„Éü„É≥„Ç∞Ë®ÄË™û„Åß„Åô„ÄÇ",
                            romaji: "javascripthadoutekinapuroguramingugengodesu"
                        },
                        {
                            japanese: "„É¨„Çπ„Éù„É≥„Ç∑„Éñ„Éá„Ç∂„Ç§„É≥„Å´„Çà„ÇäÊúÄÈÅ©„Å™Ë°®Á§∫„ÅåÂèØËÉΩ„Å´„Å™„Çä„Åæ„Åô„ÄÇ",
                            romaji: "responsibudesainnniyorisaitekinahyouzigakanouninarimasu"
                        },
                        {
                            japanese: "„Éá„Éº„Çø„Éô„Éº„Çπ„ÅØÊÉÖÂ†±„ÇíÂäπÁéáÁöÑ„Å´ÁÆ°ÁêÜ„Åô„Çã„Ç∑„Çπ„ÉÜ„É†„Åß„Åô„ÄÇ",
                            romaji: "de-tabe-suhajouhouokouritsutekinikanrisurusisutemedesu"
                        },
                        {
                            japanese: "„ÇØ„É©„Ç¶„Éâ„Ç≥„É≥„Éî„É•„Éº„ÉÜ„Ç£„É≥„Ç∞„ÅØÁèæ‰ª£„ÅÆITÂü∫Áõ§„Åß„Åô„ÄÇ",
                            romaji: "kuraudokonpyu-tinguhagendainoitkibandesu"
                        },
                        {
                            japanese: "„É¶„Éº„Ç∂„Éº„Ç®„ÇØ„Çπ„Éö„É™„Ç®„É≥„Çπ„ÇíÂêë‰∏ä„Åï„Åõ„Çã„Åì„Å®„ÅåÈáçË¶Å„Åß„Åô„ÄÇ",
                            romaji: "yu-za-ekusupiriensuwokojousaserukotigajuuyoudesu"
                        },
                        {
                            japanese: "„Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„ÅÆ„Éë„Éï„Ç©„Éº„Éû„É≥„Çπ„ÇíÊúÄÈÅ©Âåñ„Åô„ÇãÂøÖË¶Å„Åå„ÅÇ„Çä„Åæ„Åô„ÄÇ",
                            romaji: "apurike-shonnopafomansuosaiteki-kasuruhistuyougaarimasu"
                        },
                        {
                            japanese: "„Çª„Ç≠„É•„É™„ÉÜ„Ç£ÂØæÁ≠ñ„ÅØ‰ºÅÊ•≠„Å´„Å®„Å£„Å¶ÊúÄÈáçË¶ÅË™≤È°å„Åß„Åô„ÄÇ",
                            romaji: "sekyuriteitaisakuhakigyounito-tesaijuuyoukadaidesu"
                        },
                        {
                            japanese: "„Ç¶„Çß„Éñ„Çµ„Ç§„Éà„ÅÆ„Ç¢„ÇØ„Çª„Ç∑„Éì„É™„ÉÜ„Ç£„ÇíÂêë‰∏ä„Åï„Åõ„Åæ„Åó„Çá„ÅÜ„ÄÇ",
                            romaji: "uebusaitono-akusesibilitiwokojousasemasho-"
                        },
                        {
                            japanese: "„Éê„ÉÉ„ÇØ„Ç¢„ÉÉ„Éó„Å®„É™„Çπ„Éà„Ç¢„ÅÆÊâãÈ†Ü„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",
                            romaji: "bakkuapputorisutonoteju-wokakuninshitekudasai"
                        },
                        {
                            japanese: "API„ÅÆË®≠Ë®à„Å´„Åä„ÅÑ„Å¶RESTfulÂéüÂâá„ÇíÈÅµÂÆà„Åô„Çã„Åì„Å®„ÅåÂ§ßÂàá„Åß„Åô„ÄÇ",
                            romaji: "apinosekke-iniokiteresutulugensokuwojunshusurukotogataisetsudesu"
                        }
                    ],
                    hard: [
                        {
                            japanese: "Ê©üÊ¢∞Â≠¶Áøí„Ç¢„É´„Ç¥„É™„Ç∫„É†„ÅÆÊúÄÈÅ©Âåñ„Å´„ÅØÁâπÂæ¥Èáè„Ç®„É≥„Ç∏„Éã„Ç¢„É™„É≥„Ç∞„ÅåÈáçË¶Å„Åß„Åô„ÄÇ",
                            romaji: "kikigakusuuarugoritumunosaitekinihatok houryouenfiniaringugjuuyoudesu"
                        },
                        {
                            japanese: "ÂàÜÊï£„Ç∑„Çπ„ÉÜ„É†„Å´„Åä„Åë„ÇãCAPÂÆöÁêÜ„ÅÆ‰∏â„Å§„ÅÆÁâπÊÄß„ÅØÈáçË¶Å„Å™Ê¶ÇÂøµ„Åß„Åô„ÄÇ",
                            romaji: "bunsansisute muniokerurcapteiirimittunot okuseiha juuyouangainendesu"
                        },
                        {
                            japanese: "ÈáèÂ≠ê„Ç≥„É≥„Éî„É•„Éº„ÉÜ„Ç£„É≥„Ç∞„ÅØÂæìÊù•„ÅÆË®àÁÆóËÉΩÂäõ„ÇíË∂Ö„Åà„ÅüÊäÄË°ì„Åß„Åô„ÄÇ",
                            romaji: "ryoushikonpyu-tinguha juurainokeisannouryokuwokoetagijutudesu"
                        },
                        {
                            japanese: "„Éñ„É≠„ÉÉ„ÇØ„ÉÅ„Çß„Éº„É≥ÊäÄË°ì„ÅØÂàÜÊï£ÂûãÂè∞Â∏≥„Ç∑„Çπ„ÉÜ„É†„Å®„Åó„Å¶Ê≥®ÁõÆ„Åï„Çå„Å¶„ÅÑ„Åæ„Åô„ÄÇ",
                            romaji: "burokkuche-ngijutuhubunsan-gataichousisutemu toshitechuumokusareteimasu"
                        },
                        {
                            japanese: "Ê∑±Â±§Â≠¶Áøí„Å´„Åä„Åë„ÇãÂãæÈÖçÊ∂àÂ§±ÂïèÈ°å„ÅØÊúÄÈÅ©Âåñ„Å´„Åä„ÅÑ„Å¶ÈáçË¶Å„Å™Ë™≤È°å„Åß„Åô„ÄÇ",
                            romaji: "shinsougakushuuniokerukobaishoushitumondahasaiteki-kaniokitejuuyounakadaidesu"
                        },
                        {
                            japanese: "„Éû„Ç§„ÇØ„É≠„Çµ„Éº„Éì„Çπ„Ç¢„Éº„Ç≠„ÉÜ„ÇØ„ÉÅ„É£„ÅØÂ§ßË¶èÊ®°„Ç∑„Çπ„ÉÜ„É†ÈñãÁô∫„Å´ÈÅ©Áî®„Åï„Çå„Åæ„Åô„ÄÇ",
                            romaji: "maikurosa-bisa-kitekuchuhaikibokisaisutemu kaihatunitekiyousaremasu"
                        },
                        {
                            japanese: "„Ç≥„É≥„ÉÜ„Éä„Ç™„Éº„Ç±„Çπ„Éà„É¨„Éº„Ç∑„Éß„É≥„ÉÑ„Éº„É´„ÅØÈÅãÁî®ÂäπÁéá„ÇíÂ§ßÂπÖ„Å´Âêë‰∏ä„Åï„Åõ„Åæ„Åô„ÄÇ",
                            romaji: "kontenao-kesutore-shontsu-ruhaunye-kouritsuwotaihabuni kojousasemasu"
                        },
                        {
                            japanese: "GraphQL„ÅØRESTfulAPI„Å´‰ª£„Çè„ÇãÊñ∞„Åó„ÅÑ„Éá„Éº„Çø„ÇØ„Ç®„É™Ë®ÄË™û„Å®„Åó„Å¶ÊôÆÂèä„Åó„Å¶„ÅÑ„Åæ„Åô„ÄÇ",
                            romaji: "graphqlharesuturulapinidawaruatarahishide-takue-rigengotoshitehukyushiteimasu"
                        },
                        {
                            japanese: "„Ç®„ÉÉ„Ç∏„Ç≥„É≥„Éî„É•„Éº„ÉÜ„Ç£„É≥„Ç∞„ÅØ„ÇØ„É©„Ç¶„Éâ„Å®IOT„Éá„Éê„Ç§„ÇπÈñì„ÅÆÈÅÖÂª∂„ÇíÂâäÊ∏õ„Åó„Åæ„Åô„ÄÇ",
                            romaji: "ejjikonpyu-tinguhakuraudotoiotdebaisu-kannotijennwosakugeishimasu"
                        },
                        {
                            japanese: "„Çº„É≠„Éà„É©„Çπ„Éà„Çª„Ç≠„É•„É™„ÉÜ„Ç£„É¢„Éá„É´„ÅØÁèæ‰ª£„ÅÆ„Çµ„Ç§„Éê„Éº„Çª„Ç≠„É•„É™„ÉÜ„Ç£Êà¶Áï•„ÅÆÂü∫Áõ§„Åß„Åô„ÄÇ",
                            romaji: "zerotorasutosekyuritimo-deruhagendainosaiba-sekyuritisenryakunokibandesu"
                        }
                    ]
                };

                this.loadProblems().then(() => {
                    this.initializeElements();
                    this.bindEvents();
                });
            }

            async loadProblems() {
                try {
                    const response = await fetch('./problems.json');
                    this.textSamples = await response.json();
                    console.log('Problems loaded successfully');
                } catch (error) {
                    console.error('Failed to load problems:', error);
                    // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÁî®„ÅÆÂü∫Êú¨ÂïèÈ°å
                    this.textSamples = {
                        easy: [
                            {
                                japanese: "„Åì„Çì„Å´„Å°„ÅØ„ÄÇ‰ªäÊó•„ÅØ„ÅÑ„ÅÑÂ§©Ê∞ó„Åß„Åô„Å≠„ÄÇ",
                                romaji: "konnichihakyouhaiitenkidesune"
                            }
                        ],
                        medium: [
                            {
                                japanese: "JavaScript„ÅØÂãïÁöÑ„Å™„Éó„É≠„Ç∞„É©„Éü„É≥„Ç∞Ë®ÄË™û„Åß„Åô„ÄÇ",
                                romaji: "javascripthadoutekinapuroguramingugengodesu"
                            }
                        ],
                        hard: [
                            {
                                japanese: "Ê©üÊ¢∞Â≠¶Áøí„Ç¢„É´„Ç¥„É™„Ç∫„É†„ÅÆÊúÄÈÅ©Âåñ„Å´„ÅØÁâπÂæ¥Èáè„Ç®„É≥„Ç∏„Éã„Ç¢„É™„É≥„Ç∞„ÅåÈáçË¶Å„Åß„Åô„ÄÇ",
                                romaji: "kikigakusuuarugoritumunosaitekinihatok houryouenfiniaringugjuuyoudesu"
                            }
                        ]
                    };
                }
            }

            initializeElements() {
                this.textDisplay = document.getElementById('textDisplay');
                this.startBtn = document.getElementById('startBtn');
                this.resetBtn = document.getElementById('resetBtn');
                this.wpmElement = document.getElementById('wpm');
                this.accuracyElement = document.getElementById('accuracy');
                this.timerElement = document.getElementById('timer');
                this.errorsElement = document.getElementById('errors');
                this.resultModal = document.getElementById('resultModal');
            }

            bindEvents() {
                this.startBtn.addEventListener('click', () => this.startGame());
                this.resetBtn.addEventListener('click', () => this.resetGame());
                
                // „Ç≠„Éº„ÉÄ„Ç¶„É≥„Ç§„Éô„É≥„ÉàÔºà„Éö„Éº„Ç∏ÂÖ®‰Ωì„ÅßÂèó„ÅëÂèñ„ÇãÔºâ
                document.addEventListener('keydown', (e) => {
                    if (this.gameActive) {
                        this.handleKeyPress(e);
                    }
                });
                
                // „ÉÜ„Ç≠„Çπ„Éà„Éá„Ç£„Çπ„Éó„É¨„Ç§„ÅÆ„ÇØ„É™„ÉÉ„ÇØ„Åß„Éï„Ç©„Éº„Ç´„Çπ
                this.textDisplay.addEventListener('click', () => {
                    if (this.gameActive) {
                        this.textDisplay.focus();
                    }
                });
                
                // Èõ£ÊòìÂ∫¶ÈÅ∏Êäû
                document.querySelectorAll('.difficulty-btn').forEach(btn => {
                    btn.addEventListener('click', (e) => this.setDifficulty(e.target.dataset.difficulty));
                });
            }

            setDifficulty(difficulty) {
                this.difficulty = difficulty;
                this.timeLimit = difficulty === 'easy' ? 30 : difficulty === 'medium' ? 60 : 90;
                
                document.querySelectorAll('.difficulty-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelector(`[data-difficulty="${difficulty}"]`).classList.add('active');
                
                this.timerElement.textContent = this.timeLimit;
            }

            getRandomProblems() {
                const texts = this.textSamples[this.difficulty];
                const shuffled = [...texts].sort(() => Math.random() - 0.5);
                const selected = shuffled.slice(0, this.problemsPerGame);
                
                this.currentProblems = selected.map(text => text.romaji.replace(/\s/g, ''));
                this.currentJapaneseList = selected.map(text => text.japanese);
                this.currentProblemIndex = 0;
                
                return this.currentProblems[0];
            }
            
            getNextProblem() {
                this.currentProblemIndex++;
                if (this.currentProblemIndex >= this.currentProblems.length) {
                    return null; // „Ç≤„Éº„É†ÁµÇ‰∫Ü
                }
                return this.currentProblems[this.currentProblemIndex];
            }
            
            getCurrentJapanese() {
                return this.currentJapaneseList[this.currentProblemIndex];
            }
            
            // „ÉÜ„Ç≠„Çπ„Éà„Çí„É≠„Éº„ÉûÂ≠ó„Çø„Éº„Ç≤„ÉÉ„Éà„Å´Â§âÊèõ
            convertToRomajiTargets(text) {
                const targets = [];
                for (let i = 0; i < text.length; i++) {
                    const char = text[i];
                    if (this.romajiTable[char]) {
                        // „Å≤„Çâ„Åå„Å™„Éª„Ç´„Çø„Ç´„Éä„ÅÆÂ†¥Âêà
                        targets.push({
                            char: char,
                            romaji: this.romajiTable[char],
                            currentRomajiIndex: 0
                        });
                    } else if (/[a-zA-Z0-9\s\.\,\!\?\(\)\[\]\-\~\:\;]/.test(char)) {
                        // Ëã±Êï∞Â≠ó„ÉªË®òÂè∑„ÅØ„Åù„ÅÆ„Åæ„ÅæÂÖ•Âäõ
                        targets.push({
                            char: char,
                            romaji: [char.toLowerCase()], // Â∞èÊñáÂ≠ó„Å´Áµ±‰∏Ä
                            currentRomajiIndex: 0
                        });
                    } else {
                        // Êº¢Â≠ó„Å™„Å©„ÅØ„Çπ„Ç≠„ÉÉ„ÉóÔºàË°®Á§∫„ÅÆ„ÅøÔºâ
                        targets.push({
                            char: char,
                            romaji: [''],
                            currentRomajiIndex: 0,
                            isSkippable: true
                        });
                    }
                }
                return targets;
            }
            
            // ÁèæÂú®„ÅÆ„É≠„Éº„ÉûÂ≠óÂÖ•ÂäõÁä∂ÊÖã„ÇíÂèñÂæó
            getCurrentRomajiState() {
                if (this.currentTargetIndex >= this.romajiTargets.length) {
                    return null;
                }
                
                const target = this.romajiTargets[this.currentTargetIndex];
                const expectedRomaji = target.romaji[target.currentRomajiIndex];
                
                return {
                    target: target,
                    expectedRomaji: expectedRomaji,
                    progress: this.currentRomaji.length,
                    total: expectedRomaji.length
                };
            }

            startGame() {
                console.log('Starting 5-problem game...');
                this.gameActive = true;
                this.currentText = this.getRandomProblems();
                this.currentJapanese = this.getCurrentJapanese();
                this.currentIndex = 0;
                this.errors = 0;
                this.totalTyped = 0;
                this.startTime = new Date();
                this.currentInputBuffer = ''; // ÂÖ•Âäõ„Éê„ÉÉ„Éï„Ç°„ÇíÂàùÊúüÂåñ
                
                console.log('=== Game Start ===');
                console.log('Problem 1/5');
                console.log('Japanese text:', this.currentJapanese);
                console.log('Romaji text:', this.currentText);
                console.log('==================');
                
                this.displayText();
                this.startTimer();
                this.updateStats();
                
                this.startBtn.disabled = true;
                this.startBtn.textContent = `ÂïèÈ°å ${this.currentProblemIndex + 1}/${this.problemsPerGame}`;
                
                // „Éï„Ç©„Éº„Ç´„Çπ„ÇíË®≠ÂÆö
                this.textDisplay.focus();
            }

            displayText() {
                let displayHTML = '';
                
                if (this.gameActive && this.currentJapanese) {
                    // „É≠„Éº„ÉûÂ≠ó„ÅÆÂÖ•ÂäõÂØæË±°ÊñáÂ≠ó„ÇíË°®Á§∫
                    displayHTML += `<div style="margin-bottom: 15px; font-size: 1.3rem; line-height: 1.8;">`;
                    for (let i = 0; i < this.currentText.length; i++) {
                        const char = this.currentText[i];
                        let className = '';
                        
                        if (i < this.currentIndex) {
                            className = 'correct';
                        } else if (i === this.currentIndex) {
                            className = 'current';
                        }
                        
                        displayHTML += `<span class="char ${className}">${char}</span>`;
                    }
                    displayHTML += `</div>`;
                    
                    // ÁèæÂú®„ÅÆÂÖ•Âäõ„Éê„ÉÉ„Éï„Ç°„ÇíË°®Á§∫
                    if (this.currentInputBuffer && this.currentInputBuffer.length > 0) {
                        displayHTML += `<div style="margin-bottom: 15px; font-size: 0.9rem; color: #888;">`;
                        displayHTML += `ÂÖ•Âäõ‰∏≠: ${this.currentInputBuffer}`;
                        displayHTML += `</div>`;
                    }
                    
                    // Êó•Êú¨Ë™û„ÅÆÂïèÈ°åÊñá„Çí‰∏ã„Å´Ë°®Á§∫
                    displayHTML += `<div style="font-size: 1.1rem; color: #666; font-weight: 500; padding-top: 15px; border-top: 1px solid #e9ecef;">`;
                    displayHTML += `${this.currentJapanese}`;
                    displayHTML += `</div>`;
                } else {
                    displayHTML = '„Ç≤„Éº„É†„ÇíÈñãÂßã„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
                }
                
                this.textDisplay.innerHTML = displayHTML;
            }


            handleRomajiInput(inputChar) {
                if (!this.gameActive) {
                    console.log('Game not active, ignoring input');
                    return;
                }
                
                // „Çπ„Ç≠„ÉÉ„ÉóÂèØËÉΩ„Å™ÊñáÂ≠óÔºàÊº¢Â≠ó„Å™„Å©Ôºâ„ÇíËá™ÂãïÁöÑ„Å´„Çπ„Ç≠„ÉÉ„Éó
                while (this.currentTargetIndex < this.romajiTargets.length && 
                       this.romajiTargets[this.currentTargetIndex].isSkippable) {
                    console.log('Skipping character:', this.romajiTargets[this.currentTargetIndex].char);
                    this.currentIndex++;
                    this.currentTargetIndex++;
                }
                
                const state = this.getCurrentRomajiState();
                if (!state) {
                    console.log('No more targets, ending game');
                    this.endGame();
                    return;
                }
                
                console.log('=== Romaji Input Processing ===');
                console.log('Input char:', inputChar);
                console.log('Current romaji buffer:', this.currentRomaji);
                console.log('Expected romaji:', state.expectedRomaji);
                console.log('Target char:', state.target.char);
                
                // ÁèæÂú®„ÅÆÂÖ•Âäõ„Å´Êñ∞„Åó„ÅÑÊñáÂ≠ó„ÇíËøΩÂä†
                const newRomaji = this.currentRomaji + inputChar;
                
                // ÊúüÂæÖ„Åï„Çå„Çã„É≠„Éº„ÉûÂ≠ó„ÅÆÈÉ®ÂàÜ‰∏ÄËá¥„Çí„ÉÅ„Çß„ÉÉ„ÇØ
                if (state.expectedRomaji.startsWith(newRomaji)) {
                    // ÈÉ®ÂàÜ‰∏ÄËá¥ - Ê≠£„Åó„ÅÑÊñπÂêë
                    console.log('‚úÖ Partial match:', newRomaji);
                    this.currentRomaji = newRomaji;
                    this.totalTyped++;
                    
                    // ÂÆåÂÖ®‰∏ÄËá¥„Çí„ÉÅ„Çß„ÉÉ„ÇØ
                    if (newRomaji === state.expectedRomaji) {
                        console.log('üéØ Complete match!');
                        this.currentIndex++;
                        this.currentTargetIndex++;
                        this.currentRomaji = '';
                        
                        // „Ç≤„Éº„É†ÁµÇ‰∫Ü„ÉÅ„Çß„ÉÉ„ÇØ
                        if (this.currentTargetIndex >= this.romajiTargets.length) {
                            console.log('All targets completed, ending game');
                            this.endGame();
                            return;
                        }
                    }
                } else {
                    // ‰∏ÄËá¥„Åó„Å™„ÅÑ - Âà•„ÅÆË™≠„ÅøÊñπ„ÇíË©¶„Åô
                    let foundMatch = false;
                    const target = state.target;
                    
                    for (let i = 0; i < target.romaji.length; i++) {
                        if (target.romaji[i].startsWith(newRomaji)) {
                            console.log('‚úÖ Alternative romaji match:', newRomaji, '‚Üí', target.romaji[i]);
                            target.currentRomajiIndex = i;
                            this.currentRomaji = newRomaji;
                            this.totalTyped++;
                            foundMatch = true;
                            
                            // ÂÆåÂÖ®‰∏ÄËá¥„ÉÅ„Çß„ÉÉ„ÇØ
                            if (newRomaji === target.romaji[i]) {
                                console.log('üéØ Alternative complete match!');
                                this.currentIndex++;
                                this.currentTargetIndex++;
                                this.currentRomaji = '';
                                
                                if (this.currentTargetIndex >= this.romajiTargets.length) {
                                    this.endGame();
                                    return;
                                }
                            }
                            break;
                        }
                    }
                    
                    if (!foundMatch) {
                        console.log('‚ùå No match found');
                        this.errors++;
                        this.totalTyped++;
                        this.currentRomaji = ''; // „Éê„ÉÉ„Éï„Ç°„Çí„É™„Çª„ÉÉ„Éà
                        
                        // „Ç®„É©„Éº„Éè„Ç§„É©„Ç§„Éà
                        const chars = this.textDisplay.querySelectorAll('.char');
                        if (chars[this.currentIndex]) {
                            chars[this.currentIndex].classList.add('incorrect');
                            setTimeout(() => {
                                chars[this.currentIndex].classList.remove('incorrect');
                            }, 500);
                        }
                    }
                }
                
                console.log('Updated romaji buffer:', this.currentRomaji);
                console.log('Current target index:', this.currentTargetIndex);
                console.log('Current char index:', this.currentIndex);
                console.log('================================');
                
                this.displayText();
                this.updateStats();
            }

            handleKeyPress(e) {
                if (!this.gameActive) return;
                
                // „Ç§„Éô„É≥„Éà„ÅÆ„Éá„Éï„Ç©„É´„ÉàÂãï‰Ωú„ÇíÈò≤„Åê
                e.preventDefault();
                
                // ÁâπÊÆä„Ç≠„Éº„ÅØÁÑ°Ë¶ñÔºàBackspace„ÅØÈô§„ÅèÔºâ
                if (e.key.length > 1 && e.key !== 'Backspace') {
                    console.log('Special key ignored:', e.key);
                    return;
                }
                
                // Backspace„ÅÆÂá¶ÁêÜ
                if (e.key === 'Backspace') {
                    if (this.currentInputBuffer && this.currentInputBuffer.length > 0) {
                        this.currentInputBuffer = this.currentInputBuffer.slice(0, -1);
                        console.log('Backspace - input buffer:', this.currentInputBuffer);
                        this.displayText();
                    }
                    return;
                }
                
                // ÈÄöÂ∏∏„ÅÆÊñáÂ≠óÂÖ•Âäõ
                if (/^[a-zA-Z0-9\-]$/.test(e.key)) {
                    this.handleCharacterInput(e.key.toLowerCase());
                }
            }

            handleCharacterInput(char) {
                if (!this.gameActive) return;
                
                // ÂÖ•ÂäõÊñáÂ≠ó„ÇíÂ∞èÊñáÂ≠ó„Å´Â§âÊèõ
                const inputChar = char.toLowerCase();
                
                // ÁèæÂú®„ÅÆÂÖ•Âäõ„Éê„ÉÉ„Éï„Ç°„Å´ËøΩÂä†
                this.currentInputBuffer = (this.currentInputBuffer || '') + inputChar;
                
                console.log(`Input char: ${inputChar}`);
                console.log(`Current buffer: ${this.currentInputBuffer}`);
                console.log(`Looking for patterns from position: ${this.currentIndex}`);
                
                // ÁèæÂú®‰ΩçÁΩÆ„Åã„ÇâÂèØËÉΩ„Å™ÁµÑ„ÅøÂêà„Çè„Åõ„ÇíÊé¢„Åô
                const matchResult = this.findRomajiMatch();
                
                if (matchResult.isComplete) {
                    // ÂÆåÂÖ®‰∏ÄËá¥
                    console.log(`‚úÖ Complete match: ${matchResult.matchedPattern} -> advances ${matchResult.advanceCount}`);
                    this.currentIndex += matchResult.advanceCount;
                    this.totalTyped++;
                    this.currentInputBuffer = '';
                    
                    if (this.currentIndex >= this.currentText.length) {
                        this.nextProblem();
                        return;
                    }
                } else if (matchResult.hasPartialMatch) {
                    // ÈÉ®ÂàÜ‰∏ÄËá¥ - „Åæ„Å†ÂÖ•ÂäõÈÄî‰∏≠
                    console.log(`üîÑ Partial match: ${this.currentInputBuffer}`);
                    this.totalTyped++;
                } else {
                    // ‰∏ÄËá¥„Å™„Åó - „Ç®„É©„Éº
                    console.log(`‚ùå No match found for: ${this.currentInputBuffer}`);
                    this.errors++;
                    this.totalTyped++;
                    this.currentInputBuffer = '';
                }
                
                this.displayText();
                this.updateStats();
            }
            
            findRomajiMatch() {
                // Ë§áÊï∞ÊñáÂ≠ó„ÅÆ„É≠„Éº„ÉûÂ≠ó„Éë„Çø„Éº„É≥„ÇíÂÆöÁæ©
                const romajiPatterns = {
                    'ji': ['zi', 'ji'],
                    'shi': ['si', 'shi'],
                    'chi': ['ti', 'chi'],
                    'tsu': ['tu', 'tsu'],
                    'fu': ['hu', 'fu'],
                    'nn': ['n', 'nn']
                };
                
                // ÁèæÂú®‰ΩçÁΩÆ„Åã„ÇâÂßã„Åæ„ÇãÊñáÂ≠óÂàó„Çí„ÉÅ„Çß„ÉÉ„ÇØ
                for (let length = 3; length >= 1; length--) {
                    const targetSequence = this.currentText.substr(this.currentIndex, length);
                    
                    // „Éë„Çø„Éº„É≥„Å´Ë©≤ÂΩì„Åô„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                    if (romajiPatterns[targetSequence]) {
                        const patterns = romajiPatterns[targetSequence];
                        
                        for (const pattern of patterns) {
                            if (pattern === this.currentInputBuffer) {
                                // ÂÆåÂÖ®‰∏ÄËá¥
                                return {
                                    isComplete: true,
                                    hasPartialMatch: false,
                                    matchedPattern: pattern,
                                    advanceCount: length
                                };
                            } else if (pattern.startsWith(this.currentInputBuffer)) {
                                // ÈÉ®ÂàÜ‰∏ÄËá¥
                                return {
                                    isComplete: false,
                                    hasPartialMatch: true,
                                    matchedPattern: pattern,
                                    advanceCount: 0
                                };
                            }
                        }
                    }
                }
                
                // ÂçòÁ¥î„Å™1ÊñáÂ≠ó„Éû„ÉÉ„ÉÅ„Çí„ÉÅ„Çß„ÉÉ„ÇØ
                const expectedChar = this.currentText[this.currentIndex];
                if (expectedChar === this.currentInputBuffer) {
                    return {
                        isComplete: true,
                        hasPartialMatch: false,
                        matchedPattern: expectedChar,
                        advanceCount: 1
                    };
                }
                
                // ‰∏ÄËá¥„Å™„Åó
                return {
                    isComplete: false,
                    hasPartialMatch: false,
                    matchedPattern: '',
                    advanceCount: 0
                };
            }

            startTimer() {
                let timeLeft = this.timeLimit;
                this.timerElement.textContent = timeLeft;
                
                this.timerInterval = setInterval(() => {
                    timeLeft--;
                    this.timerElement.textContent = timeLeft;
                    
                    if (timeLeft <= 0) {
                        this.endGame();
                    }
                }, 1000);
            }

            updateStats() {
                if (!this.startTime) return;
                
                const currentTime = new Date();
                const timeElapsed = (currentTime - this.startTime) / 1000 / 60; // ÂàÜ
                
                // WPMË®àÁÆó (5ÊñáÂ≠ó = 1ÂçòË™û„Å®„Åó„Å¶Ë®àÁÆó)
                const wpm = Math.round((this.currentIndex / 5) / timeElapsed) || 0;
                this.wpmElement.textContent = wpm;
                
                // Ê≠£Á¢∫ÁéáË®àÁÆó
                const accuracy = this.totalTyped > 0 ? 
                    Math.round(((this.totalTyped - this.errors) / this.totalTyped) * 100) : 100;
                this.accuracyElement.textContent = accuracy + '%';
                
                // „Ç®„É©„ÉºÊï∞
                this.errorsElement.textContent = this.errors;
            }

            nextProblem() {
                const nextText = this.getNextProblem();
                if (nextText === null) {
                    // ÂÖ®ÂïèÈ°åÁµÇ‰∫Ü
                    this.endGame();
                    return;
                }
                
                // Ê¨°„ÅÆÂïèÈ°å„Å´ÈÄ≤„ÇÄ
                this.currentText = nextText;
                this.currentJapanese = this.getCurrentJapanese();
                this.currentIndex = 0;
                this.currentInputBuffer = '';
                
                console.log(`=== Problem ${this.currentProblemIndex + 1}/${this.problemsPerGame} ===`);
                console.log('Japanese text:', this.currentJapanese);
                console.log('Romaji text:', this.currentText);
                console.log('==========================================');
                
                this.startBtn.textContent = `ÂïèÈ°å ${this.currentProblemIndex + 1}/${this.problemsPerGame}`;
                this.displayText();
            }

            endGame() {
                // Ê¨°„ÅÆÂïèÈ°å„Åå„ÅÇ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
                if (this.currentProblemIndex < this.problemsPerGame - 1) {
                    this.currentProblemIndex++;
                    this.nextProblem();
                    return;
                }
                
                // ÂÖ®ÂïèÈ°åÁµÇ‰∫Ü
                this.gameActive = false;
                clearInterval(this.timerInterval);
                
                this.startBtn.disabled = false;
                this.startBtn.textContent = '„Ç≤„Éº„É†ÈñãÂßã';
                
                this.showResults();
            }

            showResults() {
                const wpm = this.wpmElement.textContent;
                const accuracy = this.accuracyElement.textContent;
                
                document.getElementById('finalWPM').textContent = wpm;
                document.getElementById('finalAccuracy').textContent = accuracy;
                document.getElementById('finalErrors').textContent = this.errors;
                document.getElementById('finalChars').textContent = `${this.problemsPerGame}ÂïèÂÆå‰∫Ü`;
                
                this.resultModal.style.display = 'flex';
            }

            resetGame() {
                this.gameActive = false;
                clearInterval(this.timerInterval);
                
                this.currentText = '';
                this.currentJapanese = '';
                this.currentIndex = 0;
                this.errors = 0;
                this.totalTyped = 0;
                this.startTime = null;
                this.currentInputBuffer = '';
                
                // 5Âïè„É¢„Éº„Éâ„ÅÆÁä∂ÊÖã„É™„Çª„ÉÉ„Éà
                this.currentProblemIndex = 0;
                this.currentProblems = [];
                this.currentJapaneseList = [];
                
                this.textDisplay.textContent = '„Ç≤„Éº„É†„ÇíÈñãÂßã„Åó„Å¶„Åè„Å†„Åï„ÅÑ';
                this.wpmElement.textContent = '0';
                this.accuracyElement.textContent = '100%';
                this.timerElement.textContent = this.timeLimit;
                this.errorsElement.textContent = '0';
                
                this.startBtn.disabled = false;
                this.startBtn.textContent = '„Ç≤„Éº„É†ÈñãÂßã';
            }
        }

        // „É¢„Éº„ÉÄ„É´„ÇíÈñâ„Åò„ÇãÈñ¢Êï∞
        function closeModal() {
            document.getElementById('resultModal').style.display = 'none';
        }

        // „Ç≤„Éº„É†ÂàùÊúüÂåñ
        const game = new TypingGame();

        // „Éè„É≥„Éê„Éº„Ç¨„Éº„É°„Éã„É•„Éº„ÅÆÂá¶ÁêÜ
        const hamburger = document.querySelector('.hamburger');
        const navMenu = document.querySelector('.nav-menu');

        hamburger.addEventListener('click', () => {
            hamburger.classList.toggle('active');
            navMenu.classList.toggle('active');
        });
    </script>
</body>
</html>